Scatter Estimation Parameters :=

;Run in debug mode
;; A new folder called extras will be created, in which many 
;; extra files will be stored 
run in debug mode := 1

;; 
;; initialisation 
;; 

; If name is provided and recomputation == true
; the file will be saved in the disk 

; Measured data
input file := ./NEMA_IQ/nema_proj_f1g1d0b0.hs

;;;; Multuplicative data ;;;;

; Attenuation Image
attenuation image filename := ./NEMA_IQ/attenuation.hv

; If only one normalisation input is set; 
; it will be assumed that are attenuation correction factors. 
; Normalisation coefficients + attenuation data
;; The algorithm will assume that the first is normalisation is the 
;; efficiency factors and the second the attenuation. You should, 
;; change this order. 
Bin Normalisation type := Chained
	Chained Bin Normalisation Parameters:=
   Bin Normalisation to apply first:= from ProjData
           Bin Normalisation From ProjData :=
            normalisation projdata filename:= ./NEMA_IQ/20170809_NEMA_UCL.n.hdr.hs
       End Bin Normalisation From ProjData:=

	Bin Normalisation to apply second:= From ProjData
		Bin Normalisation From ProjData :=
           normalisation projdata filename:= ./NEMA_IQ/atten_sino.hs
        End Bin Normalisation From ProjData:=
		
END Chained Bin Normalisation Parameters:=

;; Background data (not - normalised)
background projdata filename := ./NEMA_IQ/MLrandoms.hs

; Mask 
; If !recompute mask projdata then the filename must be set.
recompute mask projdata := 1 
mask projdata filename := ./produced_data/mask_projdata.hs 

; Input or output filename - depends on recompute  
;; If recompute is set, fwd will be performed automatically
recompute mask image := 1
mask attenuation image filename := ./produced_data/mask.hv

mask image max threshold  := 0.001
mask image additive scalarr := -0.00099 
mask image min threshold := 0.0
mask image times scalar := 100002
mask image postfilter filename := ./par_files/postfilter_Gaussian.par
;End of Mask

;Parameter file for the tail fitting of the mask image.
tail fitting par filename := ./par_files/tail_fitting.par

; Run simulation and reconstruction in 2D and export SSRB sinograms
run in 2d projdata := 1

; ScatterSimulation parameters 
scatter simulation parameters file := ./par_files/scatter_simulation.par 
use default downsampling in scatter simulation := 1

; Over-ride the values set in the scatter simulation parameter file
override scanner template := 1
override initial activity image := 1
override density image := 1
override density image for scatter points := 1

reconstruction parameter template file := ./par_files/run_reconstruction.par 

;
; This is the number of times which the Scatter Estimation will
; iterate. Default is 5

number of scatter iterations := 4

; Average the first two activity images
do average at 2 := 1

; Export scatter estimates of each iteration 
export scatter estimates of each iteration := 1

output scatter estimate name prefix := ./produced_data/scatter
output background estimate name prefix:= ./produced_data/total_back

; If provided it will be given to the ScatterSimulation 
; subsampled attenuation imagw filename := sub_atten.hv

maximum scale value := 2 ;10
minimum scale value := 0.4 ;0.1

;Upsample and fit 
; defaults to 3.
half filter width := 3
remove interleaving := 1

End Scatter Estimation Parameters :=
